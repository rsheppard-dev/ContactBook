@model IEnumerable<ContactBook.Models.Contact>
@using ContactBook.Services.Interfaces;

@inject IImageService ImageService;

@{
    ViewData["Title"] = "Contacts";
}

<div class="flex flex-wrap gap-5 items-center justify-between mb-5">
    <h1 class="uppercase font-bold text-primary text-2xl">Contacts</h1>

    <a asp-action="Create" class="btn-primary text-light flex items-center w-fit gap-2 text-sm">Add Contact
        <span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
            </svg>
        </span>
    </a>
</div>

<div class="flex sm:flex-col lg:flex-row flex-wrap justify-between sm:justify-start gap-3 mb-5 sm:mb-16 lg:mb-5">
    <form asp-action="SearchContacts" asp-controller="Contacts" class="flex items-center gap-1">
        <input type="search" name="searchString" placeholder="Search contacts" class="w-full lg:w-auto">
        <button type="submit" title="Search Contacts" class="h-full btn-primary text-sm flex items-center gap-2">
            <span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" title="Search Contacts" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
            </span>
        </button>
    </form>

    <form asp-action="Index" asp-controller="Contacts" class="flex items-center gap-1">
        <select class="w-full lg:w-auto" name="id" asp-items="@ViewBag.CategoryId" onchange="this.form.submit()" onfocus="this.selectedIndex=-1;this.blur();">
            <option>All Contacts</option>
        </select>
    </form>
</div>

<div class="space-y-16">
    @foreach (var contact in Model) {
    <div>
        <div class="sm:hidden rounded-t-lg overflow-hidden">
            <img src="@ImageService.ConvertByteArrayToFile(contact.ImageData!, contact.ImageType!)" alt="@Html.DisplayFor(modelContact => contact.FullName)" class="object-cover object-center w-full">
        </div>
        <div class="bg-mid text-dark px-3 py-3 rounded-b-lg sm:rounded-t-lg relative">
            <div class="hidden sm:block w-40 h-40 rounded-full border-b-4  border-white absolute right-0 -top-12 overflow-hidden">
                <img src="@ImageService.ConvertByteArrayToFile(contact.ImageData!, contact.ImageType!)" alt="@Html.DisplayFor(modelContact => contact.FullName)" class="object-cover">
            </div>
            <h2 class="text-xl font-bold mb-3">@Html.DisplayFor(modelContact => contact.FullName)</h2>
            <div class="flex flex-col lg:flex-row gap-5 mb-5">
                <div>
                    <span class="block">@Html.DisplayFor(modelContact => contact.Address1)</span>
                    <span class="block">@Html.DisplayFor(modelContact => contact.Address2)</span>
                    <span class="block">@Html.DisplayFor(modelContact => contact.County)</span>
                    <span class="block">@Html.DisplayFor(modelContact => contact.PostCode)</span>
                </div>

                <div class="space-y-2 text-sm">
                    <p class="flex items-center gap-2">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 opacity-40">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                            </svg>
                        </span>
                        <span>@Html.DisplayFor(modelContact => contact.Birthdate)</span>
                    </p>

                    <p class="flex items-center gap-2">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 opacity-40">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                            </svg>
                        </span>
                        <a href="tel:@Html.DisplayFor(modelContact => contact.PhoneNumber)" class="text-primary font-semibold hover:opacity-80 transition-opacity">@Html.DisplayFor(modelContact => contact.PhoneNumber)</a>
                    </p>

                    <p class="flex items-center gap-2">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 opacity-40">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                            </svg>
                        </span>
                        <span class="text-primary font-semibold hover:opacity-80 transition-opacity">@Html.DisplayFor(modelContact => contact.Email)</span>   
                    </p>
                </div>
            </div>

            <div class="flex contacts-center gap-5">
                <a asp-action="Edit" asp-route-id="@contact.Id">
                    <img src="~/images/edit.svg" alt="Edit" class="w-8 h-8 hover:scale-125 transition-transform">
                </a>
                <a asp-action="Details" asp-route-id="@contact.Id">
                    <img src="~/images/message.svg" alt="Edit" class="w-8 h-8 hover:scale-125 transition-transform">
                </a>
                <a asp-action="Delete" asp-route-id="@contact.Id">
                    <img src="~/images/delete.svg" alt="Edit" class="w-8 h-8 hover:scale-125 transition-transform">
                </a>
            </div>
        </div>
    </div>
    }
</div>